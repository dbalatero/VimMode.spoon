#!/usr/bin/env bash

set -e

epochdate=$(($(date +'%s * 1000 + %-N / 1000000')))

cat << EOF | tee -a "/tmp/permissions.sql" > /dev/null
REPLACE INTO access (service, client, client_type, allowed, prompt_count, policy_id, indirect_object_identifier_type, indirect_object_identifier, flags, last_modified)
  VALUES('kTCCServiceAppleEvents', '/usr/bin/osascript', 1, 1, 1, NULL, 0, 'com.apple.systemevents', NULL, $epochdate);

REPLACE INTO access (service, client, client_type, allowed, prompt_count, policy_id, indirect_object_identifier_type, indirect_object_identifier, flags, last_modified)
  VALUES('kTCCServiceAppleEvents', '/usr/bin/osascript', 1, 1, 1, NULL, 0, 'com.apple.systemevents', NULL, $epochdate);

REPLACE INTO access (service, client, client_type, allowed, prompt_count, policy_id, indirect_object_identifier_type, indirect_object_identifier, flags, last_modified)
  VALUES('kTCCServiceAppleEvents', '/usr/bin/osascript', 1, 1, 1, NULL, 0, 'com.apple.finder', NULL, $epochdate);

REPLACE INTO access (service, client, client_type, allowed, prompt_count, policy_id, indirect_object_identifier_type, indirect_object_identifier, flags, last_modified)
  VALUES('kTCCServiceAppleEvents', '/usr/bin/osascript', 1, 1, 1, NULL, 0, 'com.apple.finder', NULL, $epochdate);

REPLACE INTO access (service, client, client_type, allowed, prompt_count, policy_id, indirect_object_identifier_type, indirect_object_identifier, flags, last_modified)
  VALUES('kTCCServiceAppleEvents', '/usr/bin/osascript', 1, 1, 1, NULL, 0, 'com.google.Chrome', NULL, $epochdate);

REPLACE INTO access (service, client, client_type, allowed, prompt_count, policy_id, indirect_object_identifier_type, indirect_object_identifier, flags, last_modified)
  VALUES('kTCCServiceAppleEvents', '/usr/bin/osascript', 1, 1, 1, NULL, 0, 'com.google.Chrome', NULL, $epochdate);

REPLACE INTO access (service, client, client_type, allowed, prompt_count, policy_id, indirect_object_identifier_type, indirect_object_identifier, indirect_object_code_identity, flags, last_modified)
  VALUES('kTCCServiceAccessibility', 'com.google.Chrome', 0, 1, 1, NULL, NULL, 'UNUSED', NULL, 0, $epochdate);
REPLACE INTO access (service, client, client_type, allowed, prompt_count, policy_id, indirect_object_identifier_type, indirect_object_identifier, indirect_object_code_identity, flags, last_modified)
  VALUES('kTCCServicePostEvent', 'com.google.Chrome', 0, 1, 1, NULL, NULL, 'UNUSED', NULL, 0, $epochdate);
REPLACE INTO access (service, client, client_type, allowed, prompt_count, policy_id, indirect_object_identifier_type, indirect_object_identifier, indirect_object_code_identity, flags, last_modified)
  VALUES('kTCCServiceAccessibility', 'org.hammerspoon.Hammerspoon', 0, 1, 1, NULL, NULL, 'UNUSED', NULL, 0, $epochdate);
REPLACE INTO access (service, client, client_type, allowed, prompt_count, policy_id, indirect_object_identifier_type, indirect_object_identifier, indirect_object_code_identity, flags, last_modified)
  VALUES('kTCCServicePostEvent', 'org.hammerspoon.Hammerspoon', 0, 1, 1, NULL, NULL, 'UNUSED', NULL, 0, $epochdate);
REPLACE INTO access (service, client, client_type, allowed, prompt_count, policy_id, indirect_object_identifier_type, indirect_object_identifier, indirect_object_code_identity, flags, last_modified)
  VALUES('kTCCServiceAccessibility', 'com.apple.systemevents', 0, 1, 1, NULL, NULL, 'UNUSED', NULL, 0, $epochdate);
REPLACE INTO access (service, client, client_type, allowed, prompt_count, policy_id, indirect_object_identifier_type, indirect_object_identifier, indirect_object_code_identity, flags, last_modified)
  VALUES('kTCCServicePostEvent', 'com.apple.systemevents', 0, 1, 1, NULL, NULL, 'UNUSED', NULL, 0, $epochdate);
EOF

sudo sqlite3 "/Users/distiller/Library/Application Support/com.apple.TCC/TCC.db" < /tmp/permissions.sql
sudo sqlite3 "/Library/Application Support/com.apple.TCC/TCC.db" < /tmp/permissions.sql
